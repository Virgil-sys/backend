<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Book Package — Prairies Africa</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @keyframes fadeUp { from{ opacity:0; transform:translateY(8px);} to{ opacity:1; transform:translateY(0);} }
    .animate-fade-up { animation: fadeUp .45s ease both; }
    .input { @apply mt-1 block w-full rounded-md border border-gray-200 px-3 py-2; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header -->
  <header class="bg-white shadow">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-3">
        <img src="images/logo.svg" alt="Prairies Africa" class="h-10 w-auto">
        <span class="font-bold text-xl hidden sm:inline"></span>
      </a>
      <nav class="space-x-4">
        <a href="packages.html" class="text-gray-600 hover:text-amber-600">Packages</a>
        <a href="index.html#contact" class="text-gray-600 hover:text-amber-600">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Small hero -->
  <section class="bg-amber-50 border-b">
    <div class="container mx-auto px-4 py-6">
      <h2 id="pkg-hero" class="text-2xl font-semibold text-gray-900 animate-fade-up">
        Book: <span id="pkg-title">Loading package…</span>
      </h2>
      <p class="text-gray-600 mt-1 animate-fade-up" style="animation-delay:.06s">Complete your details below. We will confirm within 24 hours or process payment if you choose to pay now.</p>
    </div>
  </section>

  <main class="container mx-auto px-4 py-10">
    <!-- Package summary -->
    <div id="pkg-card" class="max-w-3xl mx-auto bg-white rounded-lg shadow p-6 mb-6">
      <h1 id="pkg-title-2" class="text-2xl font-bold mb-2">Loading package…</h1>
      <div id="pkg-meta" class="text-sm text-gray-600 mb-2"></div>
      <div id="pkg-price" class="text-amber-600 font-bold text-lg mb-4"></div>
      <p id="pkg-desc" class="text-gray-700"></p>
    </div>

    <!-- Booking form (updated: more colorful inputs + whatsapp floating) -->
    <form id="booking-form" class="max-w-3xl mx-auto bg-white rounded-lg shadow overflow-hidden" autocomplete="on" novalidate>
      <input type="hidden" name="packageId" id="packageId">
      <input type="hidden" name="packageTitle" id="packageTitle">
      <input type="hidden" name="packagePrice" id="packagePrice">

      <!-- Header -->
      <div class="bg-gradient-to-r from-amber-500 to-green-600 text-white p-6 flex items-center gap-4">
        <div class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center text-2xl">
          <i class="fas fa-ticket-alt"></i>
        </div>
        <div>
          <div class="text-sm opacity-90">You're booking</div>
          <div id="form-pkg-title" class="text-lg font-semibold" aria-live="polite">Loading package…</div>
        </div>
        <div class="ml-auto text-right">
          <div id="form-pkg-price" class="font-bold text-white/90">—</div>
          <div class="text-xs opacity-80">Secure your spot</div>
        </div>
      </div>

      <!-- Form body -->
      <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Left column: inputs -->
        <div class="space-y-4">
          <label class="block">
            <span class="text-sm text-gray-700 flex items-center gap-2">
              <i class="fas fa-user text-amber-500"></i>
              Full name
            </span>
            <input required id="name" name="name" class="input bg-white border-gray-200 focus:ring-2 focus:ring-amber-300" placeholder="Your full name" />
          </label>

          <label class="block">
            <span class="text-sm text-gray-700 flex items-center gap-2">
              <i class="fas fa-envelope text-amber-500"></i>
              Email
            </span>
            <input required id="email" name="email" type="email" class="input bg-white border-gray-200 focus:ring-2 focus:ring-amber-300" placeholder="you@domain.com" />
          </label>

          <label class="block">
            <span class="text-sm text-gray-700 flex items-center gap-2">
              <i class="fas fa-phone text-amber-500"></i>
              Phone
            </span>
            <input required id="phone" name="phone" class="input bg-white border-gray-200 focus:ring-2 focus:ring-amber-300" placeholder="+263 77 123 4567" />
          </label>

          <label class="block">
            <span class="text-sm text-gray-700 flex items-center gap-2">
              <i class="fas fa-users text-amber-500"></i>
              Number of people
            </span>
            <input required id="pax" name="pax" type="number" min="1" value="1" class="input bg-white border-gray-200 focus:ring-2 focus:ring-amber-300" />
          </label>
        </div>

        <!-- Right column: date, notes and CTA -->
        <div class="space-y-4">
          <label class="block">
            <span class="text-sm text-gray-700 flex items-center gap-2">
              <i class="fas fa-calendar-alt text-amber-500"></i>
              Preferred date
            </span>
            <input id="date" name="date" type="date" class="input bg-white border-gray-200 focus:ring-2 focus:ring-amber-300" />
          </label>

          <label class="block">
            <span class="text-sm text-gray-700 flex items-center gap-2">
              <i class="fas fa-sticky-note text-amber-500"></i>
              Special requests
            </span>
            <textarea id="notes" name="notes" rows="4" class="mt-1 block w-full rounded-md border border-gray-200 px-3 py-2" placeholder="Dietary needs, mobility, celebrations..."></textarea>
          </label>

          <div class="pt-2">
            <div class="flex flex-col sm:flex-row gap-3">
              <button id="pay-now" type="button" class="flex-1 bg-amber-600 hover:bg-amber-700 text-white px-4 py-3 rounded font-medium shadow transition transform hover:-translate-y-0.5">
                <i class="fas fa-credit-card mr-2"></i> Pay Now
              </button>

              <button id="request-book" type="button" class="flex-1 bg-white border border-gray-200 text-gray-800 px-4 py-3 rounded hover:shadow">
                <i class="fas fa-paper-plane mr-2"></i> Request Booking
              </button>
            </div>

            <div class="mt-3 flex items-center justify-between">
              <a href="packages.html" class="text-sm text-gray-500">Back to packages</a>
              <div id="msg" class="text-sm" role="status" aria-live="polite"></div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </main>

  <footer class="bg-gray-900 text-white py-8">
    <div class="container mx-auto px-4 text-center text-sm">© 2025 PrairiesAfrica.Inc</div>
  </footer>

  <!-- WhatsApp floating button -->
  <a href="https://wa.me/263776930966?text=Hi,%20I'm%20interested%20in%20this%20package" target="_blank" class="fixed bottom-6 right-6 w-14 h-14 bg-green-600 text-white rounded-full flex items-center justify-center text-2xl shadow-lg z-50 transition-transform hover:scale-110" aria-label="Chat on WhatsApp">
    <i class="fab fa-whatsapp"></i>
  </a>

  <script>
  (function(){
    // Read package info from query string and prefill UI
    const params = new URLSearchParams(location.search);
    const pkgId = params.get('id') || params.get('pkgId') || '';
    const title = params.get('title') ? decodeURIComponent(params.get('title')) : (params.get('name') ? decodeURIComponent(params.get('name')) : '');
    const price = params.get('price') || params.get('cost') || '';
    const duration = params.get('duration') || '';
    const desc = params.get('desc') ? decodeURIComponent(params.get('desc')) : '';

    // UI refs
    const pkgTitleEl = document.getElementById('pkg-title');
    const pkgTitleEl2 = document.getElementById('pkg-title-2');
    const pkgMetaEl = document.getElementById('pkg-meta');
    const pkgPriceEl = document.getElementById('pkg-price');
    const pkgDescEl = document.getElementById('pkg-desc');
    const packageIdInput = document.getElementById('packageId');
    const packageTitleInput = document.getElementById('packageTitle');
    const packagePriceInput = document.getElementById('packagePrice');
    const msg = document.getElementById('msg');

    // also update form header elements
    const formPkgTitle = document.getElementById('form-pkg-title');
    const formPkgPrice = document.getElementById('form-pkg-price');

    // Populate UI
    if (!title && !pkgId) {
      pkgTitleEl.textContent = 'No package specified';
      pkgTitleEl2.textContent = 'No package specified';
      pkgDescEl.textContent = 'Go back to the packages page and click "Book Now" on a package.';
      if (formPkgTitle) formPkgTitle.textContent = 'No package specified';
      if (formPkgPrice) formPkgPrice.textContent = '—';
    } else {
      const displayTitle = title || 'Selected package';
      pkgTitleEl.textContent = displayTitle;
      pkgTitleEl2.textContent = displayTitle;
      pkgMetaEl.textContent = duration ? duration : '';
      pkgPriceEl.textContent = price ? `From $${price}` : '';
      pkgDescEl.textContent = desc;
      packageIdInput.value = pkgId;
      packageTitleInput.value = displayTitle;
      packagePriceInput.value = price;

      if (formPkgTitle) formPkgTitle.textContent = displayTitle;
      if (formPkgPrice) formPkgPrice.textContent = price ? `From $${price}` : '—';
    }

    function showMessage(text, kind) {
      msg.textContent = text;
      msg.className = 'text-sm ' + (kind === 'error' ? 'text-red-600' : 'text-green-700');
    }

    function collectPayload(payNow) {
      return {
        packageId: packageIdInput.value,
        packageTitle: packageTitleInput.value,
        packagePrice: packagePriceInput.value,
        customer: {
          name: document.getElementById('name').value.trim(),
          email: document.getElementById('email').value.trim(),
          phone: document.getElementById('phone').value.trim()
        },
        pax: Number(document.getElementById('pax').value) || 1,
        date: document.getElementById('date').value || null,
        notes: document.getElementById('notes').value.trim(),
        payNow: !!payNow,
        createdAt: new Date().toISOString()
      };
    }

    function validate(payload) {
      if (!payload.customer.name) return 'Enter your name';
      if (!payload.customer.email || !payload.customer.email.includes('@')) return 'Enter a valid email';
      if (!payload.customer.phone) return 'Enter a phone number';
      return '';
    }

    async function submitBooking(payload) {
      // Attempts to POST to /api/book. If backend not present, fall back to localStorage.
      try {
        const res = await fetch('/api/book', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const txt = await res.text().catch(()=>null);
          throw new Error(txt || ('Server responded ' + res.status));
        }

        const data = await res.json();
        if (data.checkoutUrl) {
          window.location.href = data.checkoutUrl;
          return;
        }

        showMessage('Booking request sent. You will receive an email within 24 hours.', 'success');
        return data;
      } catch (err) {
        console.warn('booking submit error:', err);
        // Save booking locally for later backend integration
        const stored = JSON.parse(localStorage.getItem('pendingBookings')||'[]');
        stored.push(payload);
        localStorage.setItem('pendingBookings', JSON.stringify(stored));
        showMessage('Backend not available — booking saved locally. We will integrate backend soon.', 'error');
        return null;
      }
    }

    // Button handlers
    document.getElementById('pay-now').addEventListener('click', async function () {
      const payload = collectPayload(true);
      const v = validate(payload);
      if (v) return showMessage(v, 'error');
      showMessage('Processing payment request...', 'success');
      await submitBooking(payload);
    });

    document.getElementById('request-book').addEventListener('click', async function () {
      const payload = collectPayload(false);
      const v = validate(payload);
      if (v) return showMessage(v, 'error');
      showMessage('Sending booking request...', 'success');
      await submitBooking(payload);
    });

    // Accessibility: submit on Enter inside form (optional)
    document.getElementById('booking-form').addEventListener('submit', function(e){
      e.preventDefault();
      document.getElementById('request-book').click();
    });
  })();
  </script>
</body>
</html>
// ...existing code...